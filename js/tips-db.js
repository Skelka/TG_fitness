import { getStorageItem } from './app.js';

// База советов по категориям
const tipsDatabase = {
    // Советы по снижению веса
    weight_loss: [
        {
            title: 'Контроль калорий',
            text: 'Старайтесь создавать дефицит 500-700 ккал в день для здорового снижения веса'
        },
        {
            title: 'Частота приемов пищи',
            text: 'Ешьте каждые 3-4 часа небольшими порциями для контроля голода'
        },
        {
            title: 'Белок для сытости',
            text: 'Включайте белок в каждый прием пищи для лучшего контроля аппетита'
        },
        {
            title: 'Дневник питания',
            text: 'Ведите дневник питания для лучшего контроля калорий и привычек'
        },
        {
            title: 'Кардио натощак',
            text: 'Утренняя кардио тренировка натощак может ускорить жиросжигание'
        },
        {
            title: 'Правило тарелки',
            text: '1/2 тарелки - овощи, 1/4 - белок, 1/4 - сложные углеводы'
        }
    ],

    // Советы по набору мышечной массы
    muscle_gain: [
        {
            title: 'Белок для роста мышц',
            text: 'Употребляйте 1.6-2.2г белка на кг веса тела для оптимального роста мышц'
        },
        {
            title: 'Прогрессивная нагрузка',
            text: 'Постепенно увеличивайте вес или количество повторений для стимуляции роста мышц'
        },
        {
            title: 'Восстановление',
            text: 'Обеспечьте 7-9 часов сна для оптимального восстановления и роста мышц'
        },
        {
            title: 'Калорийный профицит',
            text: 'Ешьте на 300-500 ккал больше нормы для набора мышечной массы'
        },
        {
            title: 'Составные упражнения',
            text: 'Фокусируйтесь на базовых упражнениях: приседания, жим, тяга'
        },
        {
            title: 'Углеводы после тренировки',
            text: 'Принимайте быстрые углеводы в течение 30 минут после тренировки'
        }
    ],

    // Советы по тренировкам дома
    home_workouts: [
        {
            title: 'Тренировки дома',
            text: 'Используйте мебель для увеличения нагрузки: стул для отжиманий, кровать для упражнений на пресс'
        },
        {
            title: 'Импровизированные веса',
            text: 'Бутылки с водой, рюкзак с книгами могут заменить гантели для базовых упражнений'
        },
        {
            title: 'Организация пространства',
            text: 'Освободите минимум 2x2 метра для комфортного выполнения упражнений'
        },
        {
            title: 'Интервальные тренировки',
            text: 'Чередуйте высокоинтенсивные упражнения с короткими перерывами'
        },
        {
            title: 'Круговые тренировки',
            text: 'Выполняйте упражнения одно за другим без отдыха для кардио эффекта'
        },
        {
            title: 'Безопасность дома',
            text: 'Проверьте устойчивость мебели перед использованием в тренировках'
        }
    ],

    // Советы по регулярности тренировок
    consistency: [
        {
            title: 'Регулярность тренировок',
            text: 'Старайтесь тренироваться минимум 3 раза в неделю для лучших результатов'
        },
        {
            title: 'Планирование',
            text: 'Запланируйте тренировки как важные встречи в своем календаре'
        },
        {
            title: 'Гибкий подход',
            text: 'Даже 15-минутная тренировка лучше, чем пропущенная тренировка'
        },
        {
            title: 'Мотивация',
            text: 'Ставьте небольшие достижимые цели и отмечайте их выполнение'
        },
        {
            title: 'Партнер по тренировкам',
            text: 'Найдите партнера для тренировок - это повысит ответственность'
        },
        {
            title: 'Отслеживание прогресса',
            text: 'Делайте фото и замеры тела каждые 2-4 недели'
        }
    ],

    // Общие советы по здоровью
    general_health: [
        {
            title: 'Водный баланс',
            text: 'Пейте 30-40 мл воды на кг веса тела в день для поддержания здоровья'
        },
        {
            title: 'Разминка',
            text: 'Уделяйте 5-10 минут разминке перед каждой тренировкой'
        },
        {
            title: 'Растяжка',
            text: 'Растягивайтесь после тренировки для улучшения восстановления и гибкости'
        },
        {
            title: 'Сон и восстановление',
            text: 'Ложитесь спать и просыпайтесь в одно и то же время'
        },
        {
            title: 'Стресс-менеджмент',
            text: 'Практикуйте медитацию или дыхательные упражнения для снижения стресса'
        },
        {
            title: 'Активный образ жизни',
            text: 'Старайтесь проходить минимум 8000 шагов в день'
        }
    ],

    // Советы по питанию
    nutrition: [
        {
            title: 'Овощи и фрукты',
            text: 'Включайте минимум 400г овощей и фруктов в ежедневный рацион'
        },
        {
            title: 'Подготовка еды',
            text: 'Готовьте еду заранее на несколько дней для лучшего контроля питания'
        },
        {
            title: 'Здоровые перекусы',
            text: 'Держите под рукой орехи, фрукты или протеиновые батончики для перекусов'
        },
        {
            title: 'Чтение этикеток',
            text: 'Учитесь читать состав продуктов и их пищевую ценность'
        },
        {
            title: 'Порции',
            text: 'Используйте меньшие тарелки для контроля размера порций'
        },
        {
            title: 'Правило 80/20',
            text: '80% здоровой пищи, 20% любимых продуктов для баланса'
        }
    ]
};

// Функция для получения случайного совета из категории
function getRandomTip(category) {
    const tips = tipsDatabase[category];
    if (!tips || !tips.length) return null;
    return tips[Math.floor(Math.random() * tips.length)];
}

// Функция для получения персонализированных советов
async function getTips() {
    try {
        // Получаем данные профиля и прогресса
        const [profileData, programData] = await Promise.all([
            getStorageItem('profile').then(data => data ? JSON.parse(data) : null),
            getStorageItem('activeProgram').then(data => data ? JSON.parse(data) : null)
        ]);

        const tips = [];

        if (profileData) {
            // Советы на основе цели
            if (profileData.goal) {
                const goalTip = getRandomTip(profileData.goal);
                if (goalTip) tips.push(goalTip);
            }

            // Советы на основе места тренировок
            if (profileData.workoutPlace === 'home') {
                const homeTip = getRandomTip('home_workouts');
                if (homeTip) tips.push(homeTip);
            }

            // Добавляем случайный совет по питанию
            const nutritionTip = getRandomTip('nutrition');
            if (nutritionTip) tips.push(nutritionTip);
        }

        if (programData?.completedWorkouts) {
            // Советы на основе прогресса
            const workoutsThisWeek = programData.completedWorkouts.filter(w => 
                new Date(w.date) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
            ).length;

            if (workoutsThisWeek < 2) {
                const consistencyTip = getRandomTip('consistency');
                if (consistencyTip) tips.push(consistencyTip);
            }
        }

        // Всегда добавляем один общий совет по здоровью
        const healthTip = getRandomTip('general_health');
        if (healthTip) tips.push(healthTip);

        return tips;
    } catch (error) {
        console.error('Ошибка при получении советов:', error);
        return [];
    }
}

export { getTips }; 